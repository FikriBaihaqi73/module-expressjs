# Pekan 3 - Hari 16: Pagination & Query Parameter

**HARI KE-16** â€“ Menangani Data Besar
**Fokus hari ini:** Membuat API yang efisien dengan Pagination, Sorting, dan Filtering.

---

## 1. Kenapa Pagination?

Kalau produk ada 10.000, `SELECT * FROM products` akan membuat server lambat dan aplikasi klien berat. Kita harus kirim data per halaman (misal 10 per halaman).

---

## 2. Implementasi Pagination di Prisma

Gunakan `skip` dan `take`.

- `take`: Limit (Berapa data yang diambil).
- `skip`: Offset (Berapa data yang dilewati).

Rumus:
`skip = (page - 1) * limit`

```ts
app.get('/api/products', async (req, res) => {
  // Ambil query params, default page 1, limit 10
  const page = Number(req.query.page) || 1;
  const limit = Number(req.query.limit) || 10;
  const skip = (page - 1) * limit;

  // Ambil Data
  const products = await prisma.product.findMany({
    skip: skip,
    take: limit,
  });

  // Hitung Total Data (untuk info pagination)
  const totalItems = await prisma.product.count();

  res.json({
    data: products,
    pagination: {
      totalItems,
      totalPages: Math.ceil(totalItems / limit),
      currentPage: page,
      itemsPerPage: limit
    }
  });
});
```

---

## 3. Sorting & Filtering

### Sorting (OrderBy)
```ts
const sortBy = (req.query.sortBy as string) || 'createdAt';
const sortOrder = (req.query.sortOrder as string) || 'desc'; // asc / desc

const products = await prisma.product.findMany({
  // ... pagination ...
  orderBy: {
    [sortBy]: sortOrder
  }
});
```

### Filtering (Where)
```ts
const search = req.query.search as string;

const whereClause: any = {};
if (search) {
  whereClause.name = { contains: search, mode: 'insensitive' }; // Case insensitive
}

const products = await prisma.product.findMany({
  where: whereClause,
  // ... pagination & sort ...
});
```

---

## 4. Tugas Harian Hari Ke-16

**Misi:** Upgrade endpoint `GET /products` menjadi Super Power.

1.  **Pagination:** Tambahkan fitur `page` dan `limit`.
2.  **Search:** Tambahkan fitur cari berdasarkan nama.
3.  **Sorting:** Tambahkan fitur urutkan berdasarkan harga (termurah/termahal) atau tanggal (terbaru/terlama).
4.  **Response:** Format response harus menyertakan metadata pagination.

**Contoh Request:**
`GET /api/products?page=2&limit=5&search=laptop&sortBy=price&sortOrder=asc`

**Checklist:**
- [ ] Pagination berjalan (coba page 1 dan page 2, data harus beda).
- [ ] Search berfungsi.
- [ ] Sorting berfungsi.
- [ ] Metadata pagination muncul di response JSON.

---

**Tips:** Pagination adalah fitur wajib untuk API yang scalable. Jangan pernah return semua data tanpa limit! ðŸ“„
