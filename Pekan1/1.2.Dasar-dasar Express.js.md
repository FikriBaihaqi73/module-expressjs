**pekan-1/hari-2.md**  
**HARI KE-2** –Dasar Express.js  
**Fokus hari ini:** Memahami semua jenis routing (GET, POST, PUT, DELETE) + params + query string + JSON response  
**Kode yang saya kasih = HANYA CONTOH MINIMAL + PENJELASAN LENGKAP**  
**Tugas kamu = kembangkan sendiri jadi API “Toko Buku Sederhana”**

### 1. Setup Project (ESM + TypeScript) – Sama seperti kemarin

```bash
mkdir toko-buku-api
cd toko-buku-api
npm init -y
```

Edit `package.json` → tambahkan baris ini:
```json
{
  "type": "module",
  "scripts": {
    "dev": "ts-node-dev --respawn src/index.ts"
  }
}
```

Install:
```bash
npm install express dotenv
npm install -D typescript ts-node-dev @types/express @types/node
npx tsc --init
```

tsconfig.json (copy-paste):
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "ESNext",
    "moduleResolution": "node",
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true
  },
  "include": ["src"]
}
```

Buat folder `src/index.ts`

### 2. Kode Dasar + Penjelasan Baris per Baris (src/index.ts)

```ts
import express, { Request, Response } from 'express';
import dotenv from 'dotenv';

dotenv.config();

const app = express();
const PORT = process.env.PORT || 3000;

// Middleware biar bisa baca JSON dari body request
app.use(express.json());

// Data sementara (in-memory) – nanti diganti database
let books = [
  { id: 1, judul: "Belajar Node.js", penulis: "Ahmad", harga: 75000 },
  { id: 2, judul: "TypeScript untuk Pemula", penulis: "Siti", harga: 90000 },
  { id: 3, judul: "Express.js dari Nol", penulis: "Budi", harga: 120000 }
];

// 1. ROUTE GET – Home
app.get('/', (req: Request, res: Response) => {
  res.json({
    message: "Selamat datang di API Toko Buku!",
    hari: 2,
    status: "Server hidup!"
  });
});

// 2. ROUTE GET – Tampilkan semua buku
app.get('/api/buku', (req: Request, res: Response) => {
  res.json({
    success: true,
    jumlah: books.length,
    data: books
  });
});

// 3. ROUTE GET – Cari berdasarkan ID (Route Params)
app.get('/api/buku/:id', (req: Request, res: Response) => {
  const id = parseInt(req.params.id);
  const buku = books.find(b => b.id === id);

  if (!buku) {
    return res.status(404).json({
      success: false,
      message: "Buku tidak ditemukan"
    });
  }

  res.json({
    success: true,
    data: buku
  });
});

// 4. ROUTE GET – Filter dengan Query String
app.get('/api/cari', (req: Request, res: Response) => {
  const { penulis, harga_max } = req.query;

  let hasil = books;

  if (penulis) {
    hasil = hasil.filter(b => 
      b.penulis.toLowerCase().includes((penulis as string).toLowerCase())
    );
  }

  if (harga_max) {
    hasil = hasil.filter(b => b.harga <= Number(harga_max));
  }

  res.json({
    success: true,
    hasil_filter: hasil
  });
});

// 5. ROUTE POST – Tambah buku baru
app.post('/api/buku', (req: Request, res: Response) => {
  const { judul, penulis, harga } = req.body;

  const bukuBaru = {
    id: books.length + 1,
    judul,
    penulis,
    harga: Number(harga)
  };

  books.push(bukuBaru);

  res.status(201).json({
    success: true,
    message: "Buku berhasil ditambahkan",
    data: bukuBaru
  });
});

// 6. ROUTE PUT – Update buku
app.put('/api/buku/:id', (req: Request, res: Response) => {
  const id = parseInt(req.params.id);
  const index = books.findIndex(b => b.id === id);

  if (index === -1) {
    return res.status(404).json({ success: false, message: "Buku tidak ada" });
  }

  books[index] = { ...books[index], ...req.body };

  res.json({
    success: true,
    message: "Buku berhasil diupdate",
    data: books[index]
  });
});

// 7. ROUTE DELETE – Hapus buku
app.delete('/api/buku/:id', (req: Request, res: Response) => {
  const id = parseInt(req.params.id);
  const index = books.findIndex(b => b.id === id);

  if (index === -1) {
    return res.status(404).json({ success: false, message: "Buku tidak ada" });
  }

  const deleted = books.splice(index, 1);

  res.json({
    success: true,
    message: "Buku berhasil dihapus",
    data: deleted[0]
  });
});

app.listen(PORT, () => {
  console.log(`Server jalan → http://localhost:${PORT}`);
  console.log(`Coba buka semua route di atas pakai Postman!`);
});
```

### 3. TUGAS HARIAN HARI KE-2 (KERJAKAN SENDIRI – JANGAN COPY-PASTE SEMUA!)

Buatlah API **“Toko Buku Sederhana”** dengan ketentuan:

| Method | URL                     | Harus bisa apa?                                          | Wajib pakai |
|--------|-------------------------|-----------------------------------------------------------|-------------|
| GET    | `/`                     | Tampilkan pesan selamat datang + nama kamu                | JSON        |
| GET    | `/api/buku`             | Tampilkan semua buku + jumlah total                       | JSON        |
| GET    | `/api/buku/:id`         | Tampilkan 1 buku berdasarkan ID                           | Route params|
| GET    | `/api/buku?penulis=...` | Filter berdasarkan penulis (query)                        | Query string|
| POST   | `/api/buku`             | Tambah buku baru (judul, penulis, harga)                | req.body    |
| PUT    | `/api/buku/:id`         | Update buku (boleh ubah sebagian atau semua)              | req.body    |
| DELETE | `/api/buku/:id`         | Hapus buku                                                | —           |

Contoh body POST:
```json
{
  "judul": "Belajar React",
  "penulis": "Umar",
  "harga": 85000
}
```

### 4. Checklist Penilaian Hari Ke-2 (Centang semua!)

- [ ] Semua 7 route di atas BERHASIL di Postman
- [ ] Bisa filter pakai `?penulis=Ahmad`
- [ ] Bisa tambah buku lewat POST → data bertambah
- [ ] Bisa update & delete
- [ ] Semua response format JSON yang sama:
  ```json
  { "success": true, "message": "...", "data": ... }
  ```
- [ ] Commit message: `"Hari 2: Selesai semua routing CRUD + query + params"`
- [ ] Push ke GitHub

### Bonus (Kalau Cepat)
- Tambah route `/api/kategori` yang return daftar kategori buku
- Tambah route `/api/buku?harga_min=...&harga_max=...`

Besok Hari Ke-3 kita tambah:
- Middleware logging (morgan)
- Error handling global
- Async handler
- Validasi sederhana

**Hari ini cukup sampai sini dulu. Pelan-pelan tapi pasti ngerti!**  
Kerjakan tugas ini sampai benar-benar bisa sendiri ya. Kalau bingung, buka kode contoh di atas, tapi tulis ulang dengan kata-kata & logika kamu sendiri.

**Semangat santri! Kamu pasti bisa bikin API sendiri hari ini!**  
Kalau sudah selesai, kirim link repo ke grup. Mentor nungguin nih