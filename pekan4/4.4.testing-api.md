# Pekan 4 - Hari 22: Testing API (Jest + Supertest)

**HARI KE-22** – Menguji Sebelum Merilis
**Fokus hari ini:** Membuat Automated Test untuk memastikan API berjalan sesuai harapan.

---

## 1. Kenapa Testing?

Supaya kalau kita ubah kode di masa depan, kita bisa tahu kalau ada fitur lama yang rusak (Regression).

### Tools
- **Jest:** Test Runner.
- **Supertest:** Simulasi HTTP Request ke Express.

```bash
npm install jest supertest ts-jest @types/jest @types/supertest --save-dev
npx ts-jest config:init
```

---

## 2. Menulis Test

Buat file `src/tests/product.test.ts`.

```ts
import request from 'supertest';
import app from '../index'; // Pastikan export app di index.ts (bukan app.listen)

describe('GET /api/products', () => {
  it('should return 200 and list of products', async () => {
    const res = await request(app).get('/api/products');
    
    expect(res.statusCode).toEqual(200);
    expect(res.body).toHaveProperty('data');
    expect(Array.isArray(res.body.data)).toBe(true);
  });
});
```

*Catatan: Agar `app` bisa di-import tanpa menjalankan server, pisahkan `app.listen` ke file `server.ts` atau gunakan `if (require.main === module)`.*

---

## 3. Tugas Harian Hari Ke-22

**Misi:** Buat test untuk 1 flow CRUD.

1.  **Refactor:** Pisahkan `app` (Express instance) dan `server` (app.listen).
2.  **Test GET:** Pastikan return 200.
3.  **Test POST:**
    - Kirim data valid -> Expect 201.
    - Kirim data tidak valid -> Expect 400.
4.  **Run:** Jalankan `npm test`.

**Checklist:**
- [ ] `npm test` menampilkan centang hijau (PASS).
- [ ] Minimal 2 test case (Positif & Negatif).

---

**Tips:** "Green-Red-Refactor". Test yang baik membuat kita tidur nyenyak saat deploy ke production. ✅
