# Pekan 4 - Hari 21: Dokumentasi API (Swagger JSDoc)

**HARI KE-21** â€“ Manual Book untuk Frontend
**Fokus hari ini:** Membuat dokumentasi API yang otomatis ter-generate dari kodingan route kita.

---

## 1. Pilihan Dokumentasi

1.  **Postman Documentation:** Mudah, tinggal klik "Publish" di Postman.
2.  **Swagger (OpenAPI):** Standar industri. Kode mendefinisikan dokumen.

**Tools:**
- `swagger-jsdoc`: Mengubah komentar kode (JSDoc) menjadi spesifikasi Swagger.
- `swagger-ui-express`: Menampilkan halaman web dokumentasi yang cantik.

### Install
```bash
npm install swagger-jsdoc swagger-ui-express @types/swagger-jsdoc @types/swagger-ui-express
```

---

## 2. Buat Konfigurasi Swagger

Buat file konfigurasi untuk mengatur informasi dasar API dan lokasi file route yang akan dipindai.

File: `src/utils/swagger.ts`

```ts
import swaggerJsdoc from 'swagger-jsdoc';

const options: swaggerJsdoc.Options = {
  definition: {
    openapi: '3.0.0',
    info: {
      title: 'E-Commerce API Documentation',
      version: '1.0.0',
      description: 'Dokumentasi lengkap API E-Commerce',
      contact: {
        name: 'Backend Developer',
      },
    },
    servers: [
      {
        url: 'http://localhost:3000/api/v1',
        description: 'Development Server',
      },
    ],
    components: {
      securitySchemes: {
        bearerAuth: {
          type: 'http',
          scheme: 'bearer',
          bearerFormat: 'JWT',
        },
      },
    },
    security: [
      {
        bearerAuth: [],
      },
    ],
  },
  // PENTING: Tentukan file mana yang mengandung anotasi Swagger
  apis: ['./src/routes/*.ts'], 
};

const swaggerSpec = swaggerJsdoc(options);

export default swaggerSpec;
```

---

## 3. Tulis Dokumentasi di Routes

Ini bagian serunya! Kita tambahkan komentar khusus di file route agar terbaca oleh Swagger.

Buka `src/routes/auth.route.ts`:

```ts
import { Router } from 'express';
import * as AuthController from '../controllers/auth.controller';

const router = Router();

/**
 * @swagger
 * tags:
 *   name: Auth
 *   description: Manajemen autentikasi pengguna
 */

/**
 * @swagger
 * /auth/login:
 *   post:
 *     summary: Login pengguna
 *     tags: [Auth]
 *     requestBody:
 *       required: true
 *       content:
 *         application/json:
 *           schema:
 *             type: object
 *             required:
 *               - email
 *               - password
 *             properties:
 *               email:
 *                 type: string
 *                 format: email
 *                 example: user@example.com
 *               password:
 *                 type: string
 *                 format: password
 *                 example: rahasia123
 *     responses:
 *       200:
 *         description: Login berhasil
 *         content:
 *           application/json:
 *             schema:
 *               type: object
 *               properties:
 *                 message:
 *                   type: string
 *                 token:
 *                   type: string
 *       401:
 *         description: Email atau password salah
 */
router.post('/auth/login', AuthController.login);

// Lakukan hal yang sama untuk register...
router.post('/auth/register', AuthController.register);

export default router;
```

---

## 4. Pasang di App

Terakhir, panggil `swaggerUi` di file utama aplikasi (`src/app.ts`).

Di `src/app.ts`:

```ts
import express from 'express';
// ... imports lainnya
import swaggerUi from 'swagger-ui-express';
import swaggerSpec from './utils/swagger'; // Import config yang tadi dibuat

const app = express();

// ... middlewares

// Route Dokumentasi
app.use('/api-docs', swaggerUi.serve, swaggerUi.setup(swaggerSpec));

// Redirect root ke docs (opsional)
app.get('/', (req, res) => {
  res.redirect('/api-docs');
});

// ... Routes API (v1)
app.use('/api/v1', productRoutes);
// ...

export default app;
```

Sekarang coba jalankan server dan buka `http://localhost:3000/api-docs`.


---

## 5. Bersih-bersih (Cleanup)

Karena kita sudah menggunakan autentikasi standar (JWT) yang didokumentasikan dengan `bearerAuth`, middleware manual `x-api-key` yang kita buat di **Hari 4** sudah tidak diperlukan lagi. Mari kita hapus agar kode lebih bersih.

1.  **Hapus Middleware di `src/app.ts`**:
    Hapus blok kode berikut:
    ```ts
    // Custom middleware (dari Hari 4)
    app.use((req, res, next) => {
      req.startTime = Date.now();
      const apiKey = req.headers['x-api-key'] as string;
      // ...
    });
    ```
    Dan ubah route home `/` menjadi sederhana:
    ```ts
    app.get('/', (req, res) => {
      res.json({ message: 'Halo! Hari 5 â€“ MVC E-Commerce + Service' });
    });
    ```

2.  **Hapus Type Definition di `src/types/express.d.ts`**:
    Hapus properti `startTime` dan `apiKey` dari interface `Request`:
    ```ts
    interface Request {
      // Hapus ini:
      // startTime?: number;
      // apiKey?: string;
      
      user?: { ... } // Biarkan yang ini
    }
    ```

Sekarang aplikasi kita sudah bersih dan siap didokumentasikan sepenuhnya!

---

## 6. Tugas Harian Hari Ke-21

**Misi:** Migrasikan dokumentasi Endpoint Auth dan Produk ke format JSDoc.

1.  **Setup:** Install package & buat `src/utils/swagger.ts`.
2.  **Coding:** Tambahkan komentar `@swagger` di:
    - `src/routes/auth.route.ts` (Login & Register)
    - `src/routes/product.route.ts` (Get All Products)
3.  **Test:** Pastikan dokumentasi muncul otomatis di browser tanpa edit YAML manual.

**Checklist:**
- [ ] `/api-docs` bisa dibuka.
- [ ] Endpoint Auth muncul di Swagger.
- [ ] Endpoint Product muncul di Swagger.

**Kenapa Cara Ini Lebih Baik?**
Sama seperti di project **Seraloka**, dokumentasi yang nempel dengan kode (Routes/Controller) lebih mudah dijaga. Kalau kodingan berubah, kita langsung ingat buat update dokumentasinya di file yang sama! ðŸš€
