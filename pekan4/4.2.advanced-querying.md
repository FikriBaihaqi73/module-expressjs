# Pekan 4 - Hari 20: Advanced Querying (Prisma)

**HARI KE-20** – Analisis Data
**Fokus hari ini:** Melakukan query kompleks untuk kebutuhan laporan/dashboard.

---

## 1. Filter Kompleks (AND, OR)

Mencari produk yang: (Kategori Laptop **DAN** Harga < 10 Juta) **ATAU** (Kategori Aksesoris).

```ts
const products = await prisma.product.findMany({
  where: {
    OR: [
      {
        AND: [
          { category: { name: 'Laptop' } },
          { price: { lt: 10000000 } }
        ]
      },
      { category: { name: 'Aksesoris' } }
    ]
  }
});
```

---

## 2. Aggregation (Count, Sum, Avg, Min, Max)

Berguna untuk dashboard admin.

```ts
const stats = await prisma.product.aggregate({
  _count: { id: true },      // Total jumlah produk
  _avg: { price: true },     // Rata-rata harga
  _sum: { stock: true },     // Total stok semua barang
  _min: { price: true },     // Harga termurah
  _max: { price: true }      // Harga termahal
});

console.log(stats._avg.price);
```

---

## 3. Group By

Menghitung jumlah produk per kategori.

```ts
const groupStats = await prisma.product.groupBy({
  by: ['categoryId'],
  _count: {
    id: true
  },
  _avg: {
    price: true
  }
});
// Hasil: [{ categoryId: 1, _count: { id: 5 } }, { categoryId: 2, ... }]
```

---

## 4. Tugas Harian Hari Ke-20

**Misi:** Buat endpoint Dashboard Statistik.

1.  **Endpoint:** `GET /api/stats`.
2.  **Response:**
    ```json
    {
      "total_user": 100,
      "total_transaksi": 50,
      "total_pendapatan": 15000000,
      "stok_menipis": [ ...daftar produk stok < 5... ],
      "produk_termahal": { ... }
    }
    ```
3.  **Gunakan:** `aggregate`, `count`, dan `findMany` dengan filter.

**Checklist:**
- [ ] Endpoint stats berjalan cepat.
- [ ] Data akurat sesuai database.
- [ ] Menggunakan fitur Aggregation Prisma.

---

**Tips:** Jangan hitung manual pakai loop JavaScript (`forEach`) kalau datanya ribuan. Biarkan Database yang menghitungnya pakai Aggregation! Jauh lebih cepat. ⚡
